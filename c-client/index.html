<!DOCTYPE html>
<html lang="zh-CN">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>智能劳务技术网 - 专业蓝领劳务直聘平台</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <style>
       /* --- [I. 核心品牌视觉变量定义] --- */
       :root {
           --primary-blue: #2A5CAA;
           --primary-orange: #FF6B35;
           --navy: #1a1a2e;
           --gold: #D4AF37;
           --silver: #A8A8A8;
           --success: #28A745;
           --bg: #f4f7f9;
           --white: #ffffff;
           --border: #eeeeee;
           --text-main: #333333;
           --text-gray: #999999;
       }
 
       /* --- [II. 全局布局] --- */
       html, body { height: 100%; margin: 0; padding: 0; }
       body { display: flex; flex-direction: column; min-height: 100vh; background-color: var(--bg); color: var(--text-main); font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
       .main-content-wrapper { flex: 1 0 auto; }
       footer { flex-shrink: 0; background-color: var(--navy); color: #ffffff; padding: 40px 0; text-align: center; font-size: 14px; border-top: 4px solid var(--primary-blue); position: relative; z-index: 100; }
       * { box-sizing: border-box; }
       .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
 
       /* --- [III. 头部与搜索] --- */
       .top-bar { background-color: var(--primary-blue); color: white; padding: 8px 0; font-size: 13px; position: relative; z-index: 1100; }
       .top-bar .container { display: flex; justify-content: space-between; align-items: center; }
       header { background-color: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
       .main-header { padding: 15px 0; display: flex; align-items: center; justify-content: space-between; }
       .logo { font-size: 26px; font-weight: 800; color: var(--primary-blue); text-decoration: none; display: flex; align-items: center; gap: 8px; }
       .logo span { color: var(--primary-orange); }
       .header-search { flex: 1; max-width: 500px; margin: 0 30px; position: relative; display: none; }
       .header-search input { width: 100%; padding: 10px 20px; border: 2px solid #eeeeee; border-radius: 25px; outline: none; }
       .header-search button { position: absolute; right: 5px; top: 5px; border: none; background-color: var(--primary-blue); color: white; padding: 6px 15px; border-radius: 20px; cursor: pointer; }
       nav { border-top: 1px solid #eeeeee; background-color: var(--white); }
       .nav-links { display: flex; list-style: none; margin: 0; padding: 0; }
       .nav-links li a { display: block; padding: 12px 20px; text-decoration: none; color: #333; font-weight: 600; font-size: 14px; }
 
       /* --- [IV. 视图切换] --- */
       .view-section { display: none; padding-bottom: 50px; }
       .view-section.active { display: block; }
       .home-hero { background-color: var(--white); padding: 60px 0; text-align: center; }
       .home-search-container { max-width: 700px; margin: 0 auto; position: relative; }
       .home-search-container input { width: 100%; padding: 22px 35px; border-radius: 45px; border: 1px solid #ddd; background-color: #f8f9fa; font-size: 18px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
       .home-search-container i { position: absolute; right: 30px; top: 24px; color: #666; font-size: 24px; cursor: pointer; }
       .home-categories { display: flex; justify-content: space-around; padding: 40px 0; max-width: 1100px; margin: 0 auto; }
       .cat-item { text-align: center; cursor: pointer; width: 150px; transition: transform 0.3s; }
       .cat-item:hover { transform: translateY(-8px); }
       .cat-item .icon-box { width: 85px; height: 85px; border-radius: 25px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white; box-shadow: 0 12px 20px rgba(0,0,0,0.1); }
 
       /* --- [V. 列表与卡片] --- */
       .subcat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px; }
       .subcat-btn { background: var(--white); padding: 25px; border-radius: 15px; border: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
       .worker-card { background: var(--white); border-radius: 15px; padding: 25px; margin-bottom: 20px; display: flex; align-items: center; border: 1px solid #eee; cursor: pointer; }
       .worker-avatar { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; margin-right: 30px; border: 1px solid #f0f0f0; }
       .worker-price b { font-size: 32px; color: var(--primary-orange); }
 
       /* --- [VI. 通用图层] --- */
       .overlay { position: fixed; top: 0; right: -100%; width: 100%; max-width: 700px; height: 100%; background: var(--white); z-index: 2000; transition: right 0.5s cubic-bezier(0.19, 1, 0.22, 1); box-shadow: -15px 0 50px rgba(0,0,0,0.15); overflow-y: auto; }
       .overlay.active { right: 0; }
       .overlay-header { position: sticky; top: 0; background: var(--white); padding: 20px 30px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
       .backdrop { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1500; }

       /* --- [NEW PATCH: UI Fix & Finance & Comm] --- */
       .auth-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
       .auth-card { background: var(--white); width: 90%; max-width: 400px; padding: 40px; border-radius: 24px; position: relative; animation: modalPop 0.3s ease; }
       
       /* 修正：个人中心排版补丁 */
       .user-asset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 25px 0; padding: 0 10px; }
       .asset-item { background: #f8f9fa; padding: 15px 5px; border-radius: 16px; text-align: center; border: 1px solid #f0f0f0; min-height: 90px; display: flex; flex-direction: column; justify-content: center; }
       .asset-val { display: block; font-size: 20px; font-weight: 800; color: var(--navy); margin-bottom: 4px; }
       .asset-label { font-size: 11px; color: #999; font-weight: 600; }
       
       .menu-list { padding: 0 10px; }
       .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 20px 18px; background: #fff; border: 1px solid #f0f0f0; border-radius: 16px; margin-bottom: 15px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
       .menu-item:active { transform: scale(0.98); background: #fcfcfc; }
       .menu-item-left { display: flex; align-items: center; gap: 15px; font-weight: bold; color: var(--navy); }
       .menu-item i.main-icon { font-size: 18px; width: 25px; text-align: center; }
       
       /* 师傅工作台与通讯 */
       .chat-toolbar { display: flex; gap: 10px; padding: 12px 20px; background: #fff; border-top: 1px solid #eee; }
       .chat-tool-btn { background: #f0f7ff; border: 1px solid #d0e4ff; padding: 8px 15px; border-radius: 10px; font-size: 12px; color: var(--primary-blue); font-weight: bold; cursor: pointer; }
       .finance-summary { background: linear-gradient(135deg, var(--navy) 0%, #2c3e50 100%); color: #fff; padding: 30px; border-radius: 20px; margin-bottom: 25px; }
       .finance-item { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #f5f5f5; align-items: center; }
       .income-tag { color: var(--success); font-weight: bold; }
       .withdraw-tag { color: #ff4d4f; font-weight: bold; }
       .upload-placeholder-sm { width: 100%; height: 100px; border: 2px dashed #ddd; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; cursor: pointer; }
   </style>
</head>
<body>
 
   <div class="main-content-wrapper">
       <div class="top-bar"><div class="container">
           <div><i class="fas fa-tools"></i> 专业蓝领劳务·匠心服务热线：400-888-9999</div>
           <div><a href="#" style="color:white; text-decoration: none;">帮助中心</a> | <a href="#" style="color:white; text-decoration: none;">服务商入驻</a></div>
       </div></div>
 
       <header><div class="container">
           <div class="main-header">
                <a href="javascript:void(0)" onclick="app.switchView('hub-view')" class="logo">智能劳务技术<span>网</span></a>
                <div class="header-search" id="header-search-box">
                    <input type="text" placeholder="快速搜索..." id="secondary-search">
                    <button onclick="app.handleSearch('secondary')"><i class="fas fa-search"></i> 搜索</button>
                </div>
                <div id="top-login-btn" style="font-weight: bold; color: var(--primary-blue); cursor: pointer;">登录 / 注册</div>
           </div>
       </div></header>
 
       <section id="hub-view" class="view-section active">
           <div class="home-hero">
                <div class="home-search-container">
                    <input type="text" placeholder="寻找专业师傅" id="hero-search-input">
                    <i class="fas fa-search" onclick="app.handleSearch('hero')"></i>
                </div>
           </div>
           <div class="home-categories">
                <div class="cat-item" onclick="app.handleCatClick(1)"><div class="icon-box" style="background:#4285F4"><i class="fas fa-bolt"></i></div><p>水电暖通</p></div>
                <div class="cat-item" onclick="app.handleCatClick(2)"><div class="icon-box" style="background:#EA4335"><i class="fas fa-hammer"></i></div><p>装饰装修</p></div>
                <div class="cat-item" onclick="app.handleCatClick(3)"><div class="icon-box" style="background:#34A853"><i class="fas fa-couch"></i></div><p>家具门窗</p></div>
                <div class="cat-item" onclick="app.handleCatClick(4)"><div class="icon-box" style="background:#FBBC05"><i class="fas fa-truck-loading"></i></div><p>搬运装卸</p></div>
                <div class="cat-item" onclick="app.handleCatClick(5)"><div class="icon-box" style="background:#A142F4"><i class="fas fa-microchip"></i></div><p>智能家居</p></div>
           </div>
       </section>
 
       <section id="subcat-view" class="view-section container">
           <div style="padding: 20px 0; color: var(--primary-blue); cursor: pointer; font-weight: bold;" onclick="app.switchView('hub-view')"><i class="fas fa-arrow-left"></i> 返回首页</div>
           <div id="subcat-list" class="subcat-grid"></div>
       </section>
 
       <section id="worker-view" class="view-section container">
           <div style="padding: 15px 0; color: var(--primary-blue); cursor: pointer; font-weight: bold;" onclick="app.switchView('subcat-view')"><i class="fas fa-arrow-left"></i> 返回细分</div>
           <div id="worker-list" style="margin-top: 30px;"></div>
       </section>
   </div>

   <div id="auth-overlay" class="auth-overlay">
       <div class="auth-card">
           <div style="text-align:right;"><i class="fas fa-times" style="cursor:pointer; color:#ccc;" onclick="app.closeAuth()"></i></div>
           <div class="auth-tab">登录 / 注册</div>
           <div class="auth-input-group"><input type="text" class="auth-input" id="auth-phone" placeholder="请输入手机号"></div>
           <div class="auth-input-group">
               <input type="text" class="auth-input" id="auth-code" placeholder="验证码">
               <button class="btn-send-code" id="btn-sms" onclick="app.handleSMS()">获取验证码</button>
           </div>
           <label class="legal-check"><input type="checkbox" id="auth-agree"><span>我同意协议与政策</span></label>
           <button class="btn-booking-main" onclick="app.doLogin()">立即登录</button>
       </div>
   </div>

   <div id="user-overlay" class="overlay">
       <div class="overlay-header"><h3>个人中心</h3><i class="fas fa-times" style="cursor:pointer;" onclick="app.closeOverlay('user-overlay')"></i></div>
       <div style="padding: 20px;">
           <div class="section-box" style="display:flex; align-items:center; gap:20px; border:none;">
               <img id="u-avatar" src="https://i.pravatar.cc/100?u=u" style="width:70px; height:70px; border-radius:50%;">
               <div><h2 id="u-nickname" style="margin:0;">未登录</h2><p id="u-phone" style="color:#999;margin:5px 0 0 0;">账号绑定中</p></div>
           </div>
           <div class="user-asset-grid">
               <div class="asset-item" onclick="app.openOrders()"><span class="asset-val" id="u-order-count">0</span><span class="asset-label">我的预约</span></div>
               <div class="asset-item"><span class="asset-val">850</span><span class="asset-label">信用分</span></div>
               <div class="asset-item" onclick="app.openPayment()"><span class="asset-val" id="u-balance">0.00</span><span class="asset-label">钱包余额</span></div>
           </div>
           <div class="menu-list" id="main-menu-list">
               <div class="menu-item" onclick="app.openVerify()">
                   <div class="menu-item-left"><i class="fas fa-id-card main-icon" style="color:var(--primary-blue)"></i>实名认证状态</div>
                   <span id="u-verify-tag" class="verify-status status-no">未认证</span>
               </div>
               <div class="menu-item" onclick="app.openOrders()">
                   <div class="menu-item-left"><i class="fas fa-clipboard-list main-icon" style="color:#34A853"></i>我的预约订单</div><i class="fas fa-chevron-right" style="color:#ccc"></i>
               </div>
               <div class="menu-item" onclick="alert('地址功能维护中')">
                   <div class="menu-item-left"><i class="fas fa-map-marker-alt main-icon" style="color:#EA4335"></i>我的常用地址</div><i class="fas fa-chevron-right" style="color:#ccc"></i>
               </div>
               <div class="menu-item" style="margin-top:30px; justify-content:center; color:#ff4d4f; font-weight:bold; background:#fff1f0;" onclick="location.reload()">退出当前账号</div>
           </div>
       </div>
   </div>

   <div id="worker-onboarding-overlay" class="overlay" style="z-index:9500;">
       <div class="overlay-header"><h3>匠心师傅入驻申请</h3><i class="fas fa-times" style="cursor:pointer;" onclick="app.closeOverlay('worker-onboarding-overlay')"></i></div>
       <div style="padding: 25px;">
           <div class="verify-form-group"><label>1. 真实姓名</label><input type="text" class="auth-input" id="wo-name"></div>
           <div class="verify-form-group"><label>2. 性别</label><select class="auth-input" id="wo-gender"><option>男</option><option>女</option></select></div>
           <div class="verify-form-group"><label>3. 身份证号码</label><input type="text" class="auth-input" id="wo-id"></div>
           <div class="verify-form-group"><label>4. 个人职业近照</label><div class="upload-placeholder-sm"><i class="fas fa-camera"></i><span>点击上传</span></div></div>
           <div class="verify-form-group"><label>5. 近期体检证明</label><div class="upload-placeholder-sm"><i class="fas fa-file-medical"></i><span>上传证明图片</span></div></div>
           <div class="verify-form-group"><label>6. 专业特长</label><input type="text" class="auth-input" id="wo-skill" placeholder="如：强电/弱电/给排水"></div>
           <div class="verify-form-group"><label>7. 从业年限</label><input type="number" class="auth-input" id="wo-years"></div>
           <div class="verify-form-group"><label>8. 职业自我介绍</label><textarea class="voice-textarea" id="wo-intro" style="height:120px;" placeholder="展现技术水平以便评级"></textarea></div>
           <button class="btn-booking-main" onclick="app.submitWorkerOnboarding()">提交入驻资料</button>
       </div>
   </div>

   <div id="worker-dashboard-overlay" class="overlay" style="z-index:9600; background:#f8f9fa;">
       <div class="dashboard-header">
           <div style="display:flex; justify-content:space-between;">
               <h2>师傅管理后台</h2><i class="fas fa-times" style="cursor:pointer;" onclick="app.closeOverlay('worker-dashboard-overlay')"></i>
           </div>
           <div class="stat-row">
               <div class="stat-card" onclick="app.openFinance()"><small>待结算收益</small><div style="font-size:20px; font-weight:bold;" id="wd-income">¥ 0.00</div></div>
               <div class="stat-card"><small>当前评级</small><div style="font-size:20px; font-weight:bold; color:var(--gold);">L5 资深</div></div>
           </div>
       </div>
       <div class="dashboard-tabs">
           <div class="dash-tab active" id="tab-orders" onclick="app.switchDashTab('orders')">抢单中心</div>
           <div class="dash-tab" id="tab-profile" onclick="app.switchDashTab('profile')">资料修改</div>
       </div>
       <div id="dash-orders" class="dash-content-section active">
           <div style="background:#fff; padding:20px; border-radius:15px; border:1px solid #eee; margin:20px;" id="order-box">
               <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span class="order-status-tag">距离 1.2km</span><b style="color:var(--primary-orange)">¥300.00</b></div>
               <h4>全屋灯具安装与电路改造</h4>
               <p style="color:#666; font-size:13px;">地址：历下区泉城广场商业街 B102</p>
               <button class="income-btn" style="width:100%; margin-top:15px;" onclick="app.handleGrabOrder(300)">立即抢单</button>
           </div>
       </div>
       <div id="dash-profile" class="dash-content-section" style="padding:20px;">
           <div style="background:#fff; padding:20px; border-radius:15px;"><p>职业档案修改功能建设中...</p></div>
       </div>
   </div>

   <div id="finance-overlay" class="overlay" style="z-index:9900;">
       <div class="overlay-header"><h3>收益与提现</h3><i class="fas fa-times" style="cursor:pointer;" onclick="app.closeOverlay('finance-overlay')"></i></div>
       <div style="padding: 25px;">
           <div class="finance-summary">
               <p>可提现余额 (元)</p><h1 id="f-bal-val">0.00</h1>
               <button class="btn-booking-main" style="margin-top:20px;" onclick="app.doWithdraw()">申请提现到卡</button>
           </div>
           <h4>结算流水</h4>
           <div id="finance-list"></div>
       </div>
   </div>

   <div id="chat-overlay" class="chat-overlay">
       <div class="overlay-header"><h3 id="chat-title">实时沟通</h3><i class="fas fa-times" style="cursor:pointer;" onclick="app.closeOverlay('chat-overlay')"></i></div>
       <div class="chat-messages" id="chat-content"></div>
       <div class="chat-toolbar" id="comm-tools" style="display:none;">
           <button class="chat-tool-btn" onclick="app.sendLoc()"><i class="fas fa-map-marker-alt"></i> 发送实时定位</button>
           <button class="chat-tool-btn" onclick="app.sendStepImg()"><i class="fas fa-camera"></i> 节点拍照回传</button>
       </div>
       <div style="padding:20px; display:flex; gap:10px;">
           <input type="text" id="chat-input" style="flex:1; padding:12px; border-radius:20px; border:1px solid #ddd; outline:none;">
           <button onclick="app.sendChat()" style="background:var(--primary-blue); color:#fff; border:none; padding:0 20px; border-radius:20px;">发送</button>
       </div>
   </div>

   <div id="order-overlay" class="overlay"></div> <div id="rating-page" class="rating-overlay"></div> <div id="backdrop" class="backdrop" onclick="app.closeAll()"></div>

   <script>
       const app = {
           state: { 
                workers: [], userInfo: null, isLoggedIn: false, walletBalance: 0.0, userOrders: [],
                workerStatus: 'none', // none, pending, approved
                income: 0.0, financeFlow: [], currentOrder: null
           },
 
           initData() { app.state.workers = Array.from({length: 10}, (_, i) => ({ id: i, name: '师傅'+i, rating: '4.9', price: 200, dist: '1.2' })); },
           switchView(id) { document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active')); document.getElementById(id).classList.add('active'); },
           closeOverlay(id) { document.getElementById(id).classList.remove('active'); document.getElementById('backdrop').style.display = 'none'; },
           closeAll() { document.querySelectorAll('.overlay, .auth-overlay').forEach(el => el.classList.remove('active')); document.getElementById('backdrop').style.display = 'none'; },
           
           /* --- 逻辑补丁集 --- */
           openAuth() { document.getElementById('auth-overlay').style.display = 'flex'; },
           closeAuth() { document.getElementById('auth-overlay').style.display = 'none'; },
           handleSMS() { alert('模拟验证码：123456'); },
           doLogin() { this.state.isLoggedIn = true; this.state.userInfo = {nickname: '张师傅', phone: '138****8888'}; document.getElementById('top-login-btn').innerText = '欢迎您，'+this.state.userInfo.nickname; this.closeAuth(); },
           
           openUserCenter() {
               document.getElementById('u-nickname').innerText = this.state.userInfo.nickname;
               document.getElementById('u-phone').innerText = this.state.userInfo.phone;
               document.getElementById('user-overlay').classList.add('active');
               document.getElementById('backdrop').style.display = 'block';
               this.syncWorkerEntry();
           },

           // 核心修复：师傅入口逻辑
           syncWorkerEntry() {
               if(document.getElementById('dynamic-worker-btn')) document.getElementById('dynamic-worker-btn').remove();
               const menuList = document.getElementById('main-menu-list');
               const logoutBtn = menuList.lastElementChild;
               const btn = document.createElement('div');
               btn.id = 'dynamic-worker-btn'; btn.className = 'menu-item';
               
               if(this.state.workerStatus === 'none') {
                   btn.innerHTML = `<div class="menu-item-left"><i class="fas fa-user-plus main-icon" style="color:var(--primary-orange)"></i>申请成为师傅</div><i class="fas fa-chevron-right"></i>`;
                   btn.onclick = () => { this.closeAll(); document.getElementById('worker-onboarding-overlay').classList.add('active'); };
               } else if(this.state.workerStatus === 'pending') {
                   btn.innerHTML = `<div class="menu-item-left"><i class="fas fa-hourglass-half main-icon" style="color:#faad14"></i>资料审核中...</div>`;
               } else if(this.state.workerStatus === 'approved') {
                   btn.style.border = '2px solid var(--primary-orange)';
                   btn.innerHTML = `<div class="menu-item-left" style="color:var(--primary-orange)"><i class="fas fa-tools main-icon"></i><b>师傅管理工作台</b></div><i class="fas fa-chevron-right"></i>`;
                   btn.onclick = () => { this.closeAll(); document.getElementById('worker-dashboard-overlay').classList.add('active'); };
               }
               menuList.insertBefore(btn, logoutBtn);
           },

           submitWorkerOnboarding() {
               alert('资料已安全提交，进入 1.5s 模拟审核期...');
               this.state.workerStatus = 'pending';
               this.closeOverlay('worker-onboarding-overlay');
               setTimeout(() => {
                   this.state.workerStatus = 'approved';
                   alert('恭喜！入驻成功。评级结果：L5 资深师傅');
               }, 1500);
           },

           handleGrabOrder(price) {
               alert('抢单成功！已开启实时通讯。');
               this.state.income += price;
               this.state.financeFlow.unshift({type:'接单收益', amt:'+'+price, date: new Date().toLocaleString()});
               document.getElementById('wd-income').innerText = '¥ ' + this.state.income.toFixed(2);
               document.getElementById('order-box').innerHTML = `<p style="text-align:center; color:var(--success); font-weight:bold;">任务执行中...</p><button class="income-btn" style="width:100%; background:var(--primary-blue);" onclick="app.openChat('client')">进入施工通讯</button>`;
               this.state.isOrderActive = true;
           },

           openChat(type) {
               document.getElementById('chat-overlay').classList.add('active');
               document.getElementById('chat-content').innerHTML = `<div class="msg-bubble other">您好，请及时回传施工定位。</div>`;
               if(this.state.isOrderActive) document.getElementById('comm-tools').style.display = 'flex';
           },
           sendLoc() { document.getElementById('chat-content').innerHTML += `<div class="msg-bubble me" style="background:#e6f7ff; color:var(--primary-blue); border:1px solid #bae7ff;"><i class="fas fa-location-arrow"></i> [实时定位] 济南市泺源大街15号</div>`; },
           sendStepImg() { document.getElementById('chat-content').innerHTML += `<div class="msg-bubble me"><p style="font-size:12px;opacity:0.7;">[节点实拍回传]</p><img src="https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=200" style="width:100%;border-radius:10px;"></div>`; },

           openFinance() {
               this.closeOverlay('worker-dashboard-overlay');
               document.getElementById('f-bal-val').innerText = this.state.income.toFixed(2);
               const list = document.getElementById('finance-list');
               list.innerHTML = this.state.financeFlow.map(f => `<div class="finance-item"><div><b>${f.type}</b><br><small>${f.date}</small></div><span class="${f.amt.includes('+')?'income-tag':'withdraw-tag'}">${f.amt}</span></div>`).join('');
               document.getElementById('finance-overlay').classList.add('active');
           },
           doWithdraw() {
               if(this.state.income <= 0) return alert('暂无收益');
               const amt = this.state.income;
               alert(`¥${amt} 提现申请已提交，预计1个工作日到账。`);
               this.state.financeFlow.unshift({type:'余额提现', amt:'-'+amt, date: new Date().toLocaleString()});
               this.state.income = 0;
               this.openFinance();
           }
       };
 
       window.addEventListener('DOMContentLoaded', () => {
           const loginBtn = document.getElementById('top-login-btn');
           if(loginBtn) { loginBtn.onclick = () => { if(!app.state.isLoggedIn) app.openAuth(); else app.openUserCenter(); }; }
           app.initData();
       });
   </script>
</body>
</html>